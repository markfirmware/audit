<div x-data=data() x-init="init([], x => templates = x)">
  <a href=https://github.com/markfirmware/audit>
    markfirmware/audit
  </a>
  <div>
    npm search keywords:csa-template
    <ul>
        <template x-for="template in templates" :key=template.package.name>
            <div>
                <template x-if="Object.entries(template.package.links).length > 1">
                    <li>
                        <span x-text="template.package.name">
                        </span>
                        <ul>
                            <li>
                                <template x-for="[id, url] in Object.entries(template.package.links)" :key=id>
                                    <a :href=url x-text=id>
                                    </a>
                                </template>
                            </li>
                        </ul>
                    </li>
                </template>
            </div>
        </template>
        <template x-for="template in templates" :key=template.package.name>
            <div>
                <template x-if="Object.entries(template.package.links).length == 1">
                    <li>
                        <span x-text="template.package.name">
                        </span>
                        <ul>
                            <li>
                                <template x-for="[id, url] in Object.entries(template.package.links)" :key=id>
                                    <a :href=url x-text=id>
                                    </a>
                                </template>
                            </li>
                        </ul>
                    </li>
                </template>
            </div>
        </template>
    </ul>
  </div>
</div>

<script>
    function data() {
        return { templates: [] };
    }

    function init(already, update) {
        update(already);
        fetch("https://registry.npmjs.org/-/v1/search?text=keywords:csa-template&size=10&from=" + already.length)
            .then((r) => r.json())
            .then((j) => {
                var batch = j.objects;
                if (batch.length != 0) {
                    var bigger = already.concat(batch);
                    bigger.sort((x, y) => {
                        let a = x.package.name,
                            b = y.package.name;
                        return a == b ? 0 : a < b ? -1 : 1;
                    });
                    init(bigger, update);
                }
            });
    }
</script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/alpinejs/2.8.0/alpine.js></script>